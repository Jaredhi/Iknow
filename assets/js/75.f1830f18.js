(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{519:function(e,s,t){"use strict";t.r(s);var a=t(21),n=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[e._v("#")]),e._v(" 前言")]),e._v(" "),t("h3",{attrs:{id:"关于容器挂载路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关于容器挂载路径"}},[e._v("#")]),e._v(" 关于容器挂载路径")]),e._v(" "),t("p",[e._v("我一般存放到 /home/"),t("code",[e._v("username")]),e._v("/docker/ 下面，username 是你服务器上的用户名称。")]),e._v(" "),t("p",[e._v("对应挂载的文件目录应该提前创建好。例如：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" -p /home/jared/nginx/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("conf,conf.d,html,logs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"关于容器内部时间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关于容器内部时间"}},[e._v("#")]),e._v(" 关于容器内部时间")]),e._v(" "),t("blockquote",[t("p",[e._v("docker容器内时间与服务器时间差距8小时，因为原生docker是0时区，但我们服务器采用亚洲上海东八区。")])]),e._v(" "),t("h4",{attrs:{id:"未启动容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#未启动容器"}},[e._v("#")]),e._v(" 未启动容器")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("将本地的 "),t("code",[e._v("/etc/localtime")]),e._v(" 挂载到容器中 "),t("code",[e._v("-v /etc/localtime:/etc/localtime")])]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("-v /etc/localtime:/etc/localtime  \n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])])]),e._v(" "),t("li",[t("p",[e._v("（不一定需要）timezone")]),e._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("-v /etc/timezone:/etc/timezone\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 以下是文件内容")]),e._v("\nAsia/Shanghai\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])])])]),e._v(" "),t("h4",{attrs:{id:"已经启动容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#已经启动容器"}},[e._v("#")]),e._v(" 已经启动容器")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("首先进入容器 "),t("code",[e._v("docker exec -it /bin/sh")]),e._v(" 查询时间 "),t("code",[e._v("date -R")])])]),e._v(" "),t("li",[t("p",[e._v("创建文件夹"),t("code",[e._v("mkdir -p /usr/share/zoneinfo/Asia")])])]),e._v(" "),t("li",[t("p",[e._v("回到宿主机，复制宿主机里的文件到容器中")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("docker "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" /usr/share/zoneinfo/Asia/Shanghai 容器ID或容器名:/usr/share/zoneinfo/Asia\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])])]),e._v(" "),t("li",[t("p",[e._v("进入容器")]),e._v(" "),t("div",{staticClass:"language-shel line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker exec -it 容器Id或容器名\ncp -i /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[e._v("此时可以会报错"),t("code",[e._v("cp: not writing through dangling symlink '/etc/localtime'")])]),e._v(" "),t("p",[t("strong",[e._v("解决方法：")])]),e._v(" "),t("p",[e._v("删除容器内的"),t("code",[e._v("/etc/localtime")]),e._v(",重新复制")]),e._v(" "),t("div",{staticClass:"language-rm -rf localtimeshell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("rm -rf /etc/localtime\ncp -i /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])])]),e._v(" "),t("li",[t("p",[e._v("date 查看时间")]),e._v(" "),t("p",[e._v("在创建的时候最好填把 localtime 和 timezone 两个文件映射到容器内 "),t("code",[e._v("/etc/localtime")]),e._v(" 和 "),t("code",[e._v("/etc/timezone")])])])]),e._v(" "),t("h2",{attrs:{id:"nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[e._v("#")]),e._v(" Nginx")]),e._v(" "),t("h3",{attrs:{id:"挂载目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#挂载目录"}},[e._v("#")]),e._v(" 挂载目录")]),e._v(" "),t("p",[t("code",[e._v("mkdir -p /yourdir/nginx/{conf,conf.d,html,logs}")])]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("说明")]),e._v(" "),t("th",[e._v("本机")]),e._v(" "),t("th",[e._v("容器")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("配置文件")]),e._v(" "),t("td",[e._v("/opt/nginx/conf/nginx.conf")]),e._v(" "),t("td",[e._v("/etc/nginx/nginx.conf")])]),e._v(" "),t("tr",[t("td",[e._v("日志输出")]),e._v(" "),t("td",[e._v("/opt/nginx/logs")]),e._v(" "),t("td",[e._v("/var/log/nginx")])]),e._v(" "),t("tr",[t("td",[e._v("静态资源")]),e._v(" "),t("td",[e._v("/opt/nginx/html")]),e._v(" "),t("td",[e._v("/usr/share/nginx/html")])])])]),e._v(" "),t("h3",{attrs:{id:"创建容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建容器"}},[e._v("#")]),e._v(" 创建容器")]),e._v(" "),t("p",[t("strong",[e._v("注意：先将配置好的 nginx.conf 放到外部挂载的conf目录下")])]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" docker run --name nginx -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v(":80  -v /opt/nginx/conf/nginx.conf:/etc/nginx/nginx.conf  -v /opt/nginx/logs:/var/log/nginx -v /opt/nginx/html:/usr/share/nginx/html -d nginx:1.18\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"jenkins"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jenkins"}},[e._v("#")]),e._v(" Jenkins")]),e._v(" "),t("h3",{attrs:{id:"挂载目录-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#挂载目录-2"}},[e._v("#")]),e._v(" 挂载目录")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("说明")]),e._v(" "),t("th",[e._v("本机")]),e._v(" "),t("th",[e._v("容器")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("工作目录")]),e._v(" "),t("td",[e._v("/home/yourname/docker/jenkins_home")]),e._v(" "),t("td",[e._v("/var/jenkins_home")])]),e._v(" "),t("tr",[t("td",[e._v("时区")]),e._v(" "),t("td",[e._v("/home/yourname/docker/timezone")]),e._v(" "),t("td",[e._v("/etc/timezone")])]),e._v(" "),t("tr",[t("td",[e._v("时间")]),e._v(" "),t("td",[e._v("/home/yourname/docker/localtime")]),e._v(" "),t("td",[e._v("/etc/localtime")])])])]),e._v(" "),t("h3",{attrs:{id:"创建容器-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建容器-2"}},[e._v("#")]),e._v(" 创建容器")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" docker run --name jenkins_wiki  -p "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10240")]),e._v(":8080 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10241")]),e._v(":50000 -v /home/yourname/docker/jenkins_home:/var/jenkins_home -v /home/yourname/docker/timezone:/etc/timezone -v /home/yourname/docker/localtime:/etc/localtime  -d jenkins/jenkins:lts\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[e._v("#")]),e._v(" 注意事项")]),e._v(" "),t("p",[t("strong",[e._v("报错 : 权限问题")])]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("Can not "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("write")]),e._v(" to /var/jenkins_home/copy_reference_file.log. Wrong volume permissions?\ntouch: cannot "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("touch")]),e._v(" ‘/var/jenkins_home/copy_reference_file.log’: Permission denied\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[t("strong",[e._v("原因是Jenkins镜像内部使用的用户是jenkons，但是我们启动容器时的账号是root，导致没有权限操作内部目录，我们可以稍微改一下上面的命令：")])]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" docker run --name jenkins_wiki  -p "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10240")]),e._v(":8080 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10241")]),e._v(":50000 -v /home/yourname/docker/jenkins_home:/var/jenkins_home -v /home/yourname/docker/timezone:/etc/timezone -v /home/yourname/docker/localtime:/etc/localtime -u "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1001")]),e._v(" -d jenkins/jenkins:lts\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[t("strong",[e._v("这里 -u 1001 的意思是覆盖容器内部的账号，引用 id为1001的账号")])])])}),[],!1,null,null,null);s.default=n.exports}}]);