(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{530:function(s,t,n){"use strict";n.r(t);var a=n(15),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"_1、sso-single-sign-on-模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、sso-single-sign-on-模式"}},[s._v("#")]),s._v(" 1、SSO(single sign on)模式")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://jinterest.oss-cn-shenzhen.aliyuncs.com/img/gomall/%E5%88%86%E5%B8%83%E5%BC%8Fsso%E6%A8%A1%E5%BC%8F.jpg",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("优点 ：")]),s._v(" 用户身份信息独立管理，更好的分布式管理。可以自己扩展安全策略")]),s._v(" "),n("p",[n("strong",[s._v("缺点：")]),s._v(" 认证服务器访问压力较大。")]),s._v(" "),n("h2",{attrs:{id:"_2、token模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、token模式"}},[s._v("#")]),s._v(" 2、Token模式")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://jinterest.oss-cn-shenzhen.aliyuncs.com/img/gomall/token%E6%A8%A1%E5%BC%8F.jpg",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("优点：")])]),s._v(" "),n("p",[s._v("无状态： token无状态，session有状态的")]),s._v(" "),n("p",[s._v("基于标准化: 你的API可以采用标准化的 JSON Web Token (JWT)")]),s._v(" "),n("p",[n("strong",[s._v("缺点:")]),s._v(" 占用带宽。无法在服务器端销毁")]),s._v(" "),n("h3",{attrs:{id:"解决方案-jwt令牌"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决方案-jwt令牌"}},[s._v("#")]),s._v(" 解决方案：JWT令牌")]),s._v(" "),n("p",[n("strong",[s._v("JWT用法：")])]),s._v(" "),n("p",[s._v("客户端接收服务器按一定规则生成然后返回的JWT，将其存储在Cookie或localStorage中。此后，客户端将在与服务器交互中都会带JWT。如果将它存储在Cookie中，就可以自动发送，但是不会跨域，因此一般是将它放入HTTP请求的Header Authorization字段中。当跨域时，也可以将JWT被放置于POST请求的数据主体中。")]),s._v(" "),n("p",[n("strong",[s._v("JWT问题和趋势：")])]),s._v(" "),n("ul",[n("li",[s._v("JWT不仅可用于认证，还可用于信息交换。善用JWT有助于减少服务器请求数据库的次数。")]),s._v(" "),n("li",[s._v("生产的token可以包含基本信息，比如id、用户昵称、头像等信息，避免再次查库")]),s._v(" "),n("li",[s._v("存储在客户端，不占用服务端的内存资源")]),s._v(" "),n("li",[s._v("JWT默认不加密，但可以加密。生成原始令牌后，可以再次对其进行加密。")]),s._v(" "),n("li",[s._v("当JWT未加密时，一些私密数据无法通过JWT传输。")]),s._v(" "),n("li",[s._v("JWT的最大缺点是服务器不保存会话状态，所以在使用期间不可能取消令牌或更改令牌的权限。也就是说，一旦JWT签发，在有效期内将会一直有效。")]),s._v(" "),n("li",[s._v("JWT本身包含认证信息，token是经过base64编码，所以可以解码，因此token加密前的对象不应该包含敏感信息，一旦信息泄露，任何人都可以获得令牌的所有权限。为了减少盗用，JWT的有效期不宜设置太长。对于某些重要操作，用户在使用时应该每次都进行进行身份验证。")]),s._v(" "),n("li",[s._v("为了减少盗用和窃取，JWT不建议使用HTTP协议来传输代码，而是使用加密的HTTPS协议进行传输。")])]),s._v(" "),n("h2",{attrs:{id:"_3、oauth2-0"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3、oauth2-0"}},[s._v("#")]),s._v(" 3、OAuth2.0")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://jinterest.oss-cn-shenzhen.aliyuncs.com/img/gomall/OAuth2.0.jpg",alt:""}})]),s._v(" "),n("h2",{attrs:{id:"解决session共享问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决session共享问题"}},[s._v("#")]),s._v(" 解决Session共享问题")]),s._v(" "),n("h3",{attrs:{id:"使用springsession完成子域session共享"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用springsession完成子域session共享"}},[s._v("#")]),s._v(" 使用Springsession完成子域session共享")]),s._v(" "),n("p",[s._v("使用cookie存储"),n("code",[s._v("jsessionid")]),s._v("并设定为"),n("code",[s._v(".gomall.com")]),s._v("域名下，这样所有相关的域名请求都会携带这个cookie，然后经过springsession的过滤器执行链包装成一个获取session的请求，去存储session的数据库中获取。")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * springsession的核心原理：\n * \t\t1:@EnableRedisHttpSession导入RedisHttpSessionConfiguration配置sessionRepository==》RedisHttpSessionConfiguration给容器中添加了一个组件：RedisIndexedSessionRepository：==》redis操作session，session的增删改查封装类\n * \t\t2：RedisHttpSessionConfiguration 继承了SpringHttpSessionConfiguration这里面有一个SessionRepositoryFilter组件==》filiter：session存储过滤器：每个请求过来都必须经过filiter\n * \t\t1：创建的时候，就自动从容器中获取到了sessionRepository\n * \t\t2：SessionRepositoryFilter类里面调用了doFilterInternal方法==》原始的request,response都被这个方法包装成了SessionRepositoryRequestWrapper  SessionRepositoryResponseWrapper\n * \t\t3：以后获取session。request.getSession\n * \t\t4：wrappedRequest.getSession()===>SessionRespository中获取到\n * 装饰者模式\n * 自动延期，redis中的数据也是有过期时间的\n **/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@EnableRedisHttpSession")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GomallSessionConfig")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CookieSerializer")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cookieSerializer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultCookieSerializer")]),s._v(" serializer "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultCookieSerializer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setCookieName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GOSESSION"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置cookie名字")]),s._v("\n        serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDomainName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gomall.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 指定域名")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisSerializer")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("springSessionDefaultRedisSerializer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GenericJackson2JsonRedisSerializer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);